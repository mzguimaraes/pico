pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
function _init()
 music()
end
cols={0,1,2,8,9,10,15,7}
function _draw()
 --position of playhead on ch0
 local beat=stat(20)
 --which pattern is playing
 --on 3 channels
 local patts={stat(16),stat(17),
 stat(18)}

 cls()
 --vol of current note
 local vols={}
 for i=1,#patts do
  local note=
 	get_note(patts[i],beat)
  local vol=band(note[2],0b00001110)
	 vol=shr(vol,1)
	 local pitch=band(note[1],0b00111111)
	 fillp(pitch+64*(pitch+1)+128*pitch)
	 rectfill(0,(i-1)*42,128,i*42,cols[vol])
	end	
end

function get_note(sfx, time)
  local addr = 0x3200 + 68*sfx + 2*time
  return { peek(addr) , peek(addr + 1) }
end

__map__
0000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010c00001805200002130520000212052000021305200002170520000213052000021205200002130520000215052000021105200002100520000211052000021705200002130520000212052000021305200002
010c0000180521a052180521a0521805200002130520000213052000021305200002120520000213052000020000200002180520000218052000021805200002180520000218052000021a052000021c05200002
010c00001c0521d0521c0521d0521c052000021805200002180520000218052000021705200002180520000200002000021c052000021c052000021c052000021c052000021c052000021d052000021f05200002
010c000024052000022105200002200520000221052000021d052000021d052000021c052000021d0520000224052000022105200002200520000221052000021e052000021e052000021c052000021e05200002
010c000000002000021a052000021a052000021a052000021a052000021a052000021c052000021e052000021f052000021f052000021e052000021f052000021305200002000020000200002000020000200002
010600001500200002000020000217002000021300200002150020000217002000021305213052000020000215052150521500215002000020000217002170021705217052000020000200002000020000200002
010c000018052000021a052000021c05200002000020000218052000021a052000021c052000020000200002110520000211052000021005200002110520000200002000023c052000023c052000020000200002
010c00001305200002150520000217052000020000200002130520000215052000021705200002000020000218052000021805200002170520000218052000020000200002000020000200002000020000200002
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010c00000015500000061550715500155000000615507155001550000006155071550015500000061550715505155000000b1550c15505155000000b1550c1550715500000101550e1550715500000101550e155
010c00000715500000091550b1550715500000091550b1550715500000101550e1550715500000101550e15500155000000615507155001550000006155071550015500000001150000000105000000000000000
010c00000c1550000013155000001015500000131550000012155000001315500000071550000013155000000c155000001315500000101550000013155000001215500000131550000007155000001315500000
010c0000051550510505115001000c155001000c11500100051550010005115001000c155001000c11500100061550010006115001000e155001000e11500100061550010006115001000e155001000e11500000
010c00000215500100021150010009155001000911500100021550010002115001000915500100091150010007155001000711500100071550010007115001000b155001000b1150010000000000000000000000
010c00000015500000061550715500155000000615507155001550000006155071550015500000061550715505155000000b1550915505155000000b1550915505155000000b1550915505155000000b15509155
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010c0000280250000028025000002b0250000030025000002800528005280050000028025280252b0052b0252d025000002b0250000030025000002b02500000280250000028025000002b025000001f02500000
010c00002b025000002d025000002b025000002802500000240250000000000000002802529025000002b0252d025000002b0250000030025000002b025000002d025000002b0250000028025000002b02500000
010c00000000000000280252a0252c025000002d0252a0052f025000002b0252d0252f02500000300252d00532025000002f02530025320250000034025000003502500000320253402535025000003202500000
010c000037025000003502534025320250000034025000003502500000340253202530025000002f025000003202500000300252f0252d025000002b025000002902500000280250000026025000002300500000
000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
00 0a144344
00 10194344
00 11154344
00 0f574344
00 0b161e44
00 0c161f44
00 0d172044
00 0e182144
00 0f424344
00 0b161e44
00 0c161f44
00 0d172044
00 0e182144
02 0f424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
02 0f424344

